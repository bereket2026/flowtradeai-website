<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FlowTradeAI Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { margin:0; background:#020617; color:#e5e7eb; font-family:Arial }
header { padding:15px 30px; border-bottom:1px solid #1e293b; display:flex; justify-content:space-between }
.card { background:#0f172a; padding:20px; border-radius:14px; margin:20px }
.price { font-size:22px; font-weight:bold }
.buy { color:#22c55e }
.sell { color:#ef4444 }
.hold { color:#facc15 }
.pos { color:#22c55e }
.neg { color:#ef4444 }
button { padding:10px 16px; border:none; border-radius:8px; cursor:pointer }
.on { background:#22c55e }
.off { background:#64748b; color:white }
</style>
</head>

<body>

<script>
if (!localStorage.getItem("token")) location.href="login.html";
</script>

<header>
  <h2>FlowTradeAI</h2>
  <button onclick="logout()">Logout</button>
</header>

<div class="card">
  <h3>Account</h3>
  <div id="balance" class="price">...</div>
  <div id="pnl"></div>
</div>

<div class="card">
  <h3>AI Signal</h3>
  <div id="signal" class="price">...</div>
  <div id="confidence"></div>
  <div id="price"></div>
</div>

<div class="card">
  <h3>Position</h3>
  <div id="position">None</div>
</div>

<div class="card">
  <h3>Auto Trading</h3>
  <button id="autoBtn" class="off" onclick="toggleAutoTrade()">OFF</button>
</div>

<script>
const API = "https://flowtradeai-backend-v3.onrender.com";

function logout(){
  localStorage.clear();
  location.href="login.html";
}

async function loadAll(){
  const d = await (await fetch(API+"/ai-signal")).json();
  const a = await (await fetch(API+"/account")).json();
  const s = await (await fetch(API+"/auto-trade/status")).json();

  balance.innerText = "$"+a.balance;
  pnl.innerText = "PnL: "+a.total_pnl;
  pnl.className = a.total_pnl >= 0 ? "pos" : "neg";

  signal.innerText = d.signal;
  signal.className = "price "+d.signal.toLowerCase();
  confidence.innerText = "Confidence "+d.confidence+"%";
  price.innerText = "Price $"+d.price;

  if(d.position){
    position.innerHTML = `
      Entry: $${d.position.entry}<br>
      SL: $${d.position.sl.toFixed(2)}<br>
      TP: $${d.position.tp.toFixed(2)}
    `;
  } else {
    position.innerText = "None";
  }

  autoBtn.innerText = s.enabled ? "ON" : "OFF";
  autoBtn.className = s.enabled ? "on" : "off";
}

async function toggleAutoTrade(){
  await fetch(API+"/auto-trade/toggle",{method:"POST"});
}

loadAll();
setInterval(loadAll, 4000);
</script>

</body>
</html>
